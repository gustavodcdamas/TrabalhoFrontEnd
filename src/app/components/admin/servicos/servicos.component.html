<div class="servicos-container">
  <div class="page-header">
    <h1>Gerenciamento de Servi√ßos</h1>
    <div class="actions">
      <button class="add-button" (click)="abrirModalNovoServicos()">+ Novo Servi√ßo</button>
      <div class="search-bar">
        <fa-icon [icon]="['fas', 'magnifying-glass']" class="icon"></fa-icon>
        <input 
          type="text" 
          class="search-input"
          [(ngModel)]="searchTerm" 
          (input)="searchServicos(searchTerm)" 
          placeholder="Buscar servi√ßo...">
      </div>
    </div>
  </div>

  <div class="filter-bar">
    <div class="filter-item" [ngClass]="{'active': currentFilter === 'all'}" (click)="filterServicos('all')">Todos</div>
    <div class="filter-item" [ngClass]="{'active': currentFilter === 'ativo'}" (click)="filterServicos('ativo')">Ativos</div>
    <div class="filter-item" [ngClass]="{'active': currentFilter === 'inativo'}" (click)="filterServicos('inativo')">Inativos</div>
    <div class="sort-controls">
      <button class="add-button" (click)="toggleSort()">
        Ordenar: {{ currentSort === 'recentes' ? 'Mais Recentes' : 'Mais Antigos' }}
      </button>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-container">
    <p>Carregando servi√ßos...</p>
  </div>

  <!-- Grid de Servi√ßos -->
  <div class="servicos-grid" *ngIf="!isLoading">
    <div class="servicos-card" *ngFor="let servicos of filteredServicos">
      <div class="servicos-image">
        <img [src]="getImageUrl(servicos.icon || servicos.image)" [alt]="servicos.titulo" 
             (error)="onImageError($event)" loading="lazy">
      </div>
      <div class="servicos-body">
        <h3 class="servicos-title">{{ servicos.titulo }}</h3>
        <p class="servicos-client">Cliente: {{ servicos.cliente }}</p>
        <p class="servicos-description">{{ servicos.descricao }}</p>
        <div class="servicos-meta">
          <span class="status" [ngClass]="'status-' + servicos.status">{{ servicos.status }}</span>
          <span class="date">{{ formatDate(servicos.dataCriacao) }}</span>
        </div>
      </div>
      <div class="servicos-footer">
        <button class="action-button edit" (click)="editarServicos(servicos.id)" title="Editar servi√ßo">
          Editar
        </button>
        <button class="action-button details" (click)="verDetalhesServicos(servicos.id)" title="Ver detalhes">
          Detalhes
        </button>
        <button class="action-button delete" (click)="deletarServicos(servicos.id)" title="Excluir servi√ßo">
          Excluir
        </button>
      </div>
    </div>
  </div>

  <!-- Mensagem quando n√£o h√° servi√ßos -->
  <div class="no-servicos-message" *ngIf="!isLoading && filteredServicos.length === 0">
    <div class="empty-state">
      <h3>{{ getEmptyStateMessage() }}</h3>
      <p>{{ getEmptyStateDescription() }}</p>
      <button class="add-button" (click)="abrirModalNovoServicos()">+ Adicionar Novo Servi√ßo</button>
    </div>
  </div>

  <!-- Pagina√ß√£o -->
  <div class="pagination" *ngIf="!isLoading && filteredServicos.length > 0">
    <button class="pagination-button" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">&lt;</button>

    <ng-container *ngFor="let page of getPaginationArray()">
      <button class="pagination-button" [ngClass]="{'active': currentPage === page}" (click)="changePage(page)">
        {{ page }}
      </button>
    </ng-container>

    <button class="pagination-button" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">&gt;</button>
    
    <div class="pagination-info">
      P√°gina {{ currentPage }} de {{ totalPages }} ({{ getTotalItems() }} servi√ßos)
    </div>
  </div>

  <!-- Modal de Novo/Editar Servi√ßo -->
  <div class="modal" *ngIf="showNovoServicosModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Editar Servi√ßo' : 'Novo Servi√ßo' }}</h2>
        <button class="close-button" (click)="fecharModalNovoServicos()">&times;</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="servicosForm" (ngSubmit)="salvarServicos()">
          
          <!-- Preview da imagem atual (modo edi√ß√£o) -->
          <div class="form-group" *ngIf="isEditMode && currentImagePreview">
            <label>√çcone Atual</label>
            <div class="current-image-preview">
              <img [src]="currentImagePreview" alt="√çcone atual" class="preview-image">
              <p class="preview-text">Selecione um novo √≠cone para substituir</p>
            </div>
          </div>

          <!-- Upload de √çcone -->
          <div class="form-group">
            <label for="imagem">{{ isEditMode ? 'Novo √çcone (opcional)' : 'Upload de √çcone *' }}</label>
            <input type="file" id="imagem" (change)="onFileSelected($event)" accept="image/*">
            <small *ngIf="selectedFile" class="text-success">
              üìÅ Arquivo selecionado: {{ selectedFile.name }} ({{ formatFileSize(selectedFile.size) }})
            </small>
            <div *ngIf="servicosForm.get('icon')?.touched && servicosForm.get('icon')?.invalid && !isEditMode" class="text-danger">
              Por favor, selecione um √≠cone
            </div>
            <small class="form-help">
              Formatos aceitos: JPG, PNG, WebP. Tamanho m√°ximo: 5MB
            </small>
          </div>

          <!-- T√≠tulo (opcional) -->
          <div class="form-group">
            <label for="titulo">T√≠tulo do Servi√ßo</label>
            <input type="text" id="titulo" formControlName="titulo" placeholder="Deixe vazio para gerar automaticamente">
            <small class="form-help">Se n√£o preenchido, ser√° gerado como "Servi√ßo [Nome do Cliente]"</small>
          </div>

          <!-- Cliente -->
          <div class="form-group">
            <label for="cliente">Cliente *</label>
            <input type="text" id="cliente" formControlName="cliente" placeholder="Nome do cliente">
            <div class="error-message" *ngIf="hasError('cliente', 'required')">
              Cliente √© obrigat√≥rio
            </div>
            <div class="error-message" *ngIf="hasError('cliente', 'minlength')">
              Cliente deve ter pelo menos 3 caracteres
            </div>
          </div>

          <!-- Descri√ß√£o -->
          <div class="form-group">
            <label for="descricao">Descri√ß√£o *</label>
            <textarea id="descricao" formControlName="descricao" rows="4" placeholder="Descri√ß√£o detalhada do servi√ßo"></textarea>
            <div class="error-message" *ngIf="hasError('descricao', 'required')">
              Descri√ß√£o √© obrigat√≥ria
            </div>
            <div class="error-message" *ngIf="hasError('descricao', 'minlength')">
              Descri√ß√£o deve ter pelo menos 10 caracteres
            </div>
            <small class="form-help">{{ servicosForm.get('descricao')?.value?.length || 0 }} caracteres</small>
          </div>

          <!-- Status (apenas para edi√ß√£o) -->
          <div class="form-group" *ngIf="isEditMode">
            <label for="status">Status</label>
            <select id="status" formControlName="status">
              <option value="ativo">Ativo</option>
              <option value="inativo">Inativo</option>
            </select>
          </div>

          <!-- A√ß√µes do Modal -->
          <div class="form-actions">
            <button type="submit" class="save-button" [disabled]="!isFormValid()" [class.loading]="isSubmitting">
              {{ isSubmitting ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Criar Servi√ßo') }}
            </button>
            <button type="button" class="cancel-button" (click)="fecharModalNovoServicos()" [disabled]="isSubmitting">
              Cancelar
            </button>
          </div>

          <!-- Debug Info (apenas em desenvolvimento) -->
          <div class="debug-info" *ngIf="showDebugInfo">
            <h4>Debug Info:</h4>
            <p><strong>Form Valid:</strong> {{ servicosForm.valid }}</p>
            <p><strong>Is Edit Mode:</strong> {{ isEditMode }}</p>
            <p><strong>Selected File:</strong> {{ selectedFile?.name || 'Nenhum arquivo' }}</p>
            <p><strong>Form Errors:</strong></p>
            <pre>{{ getFormErrors() | json }}</pre>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Confirma√ß√£o de Exclus√£o -->
  <div class="modal" *ngIf="showDeleteModal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2>Confirmar Exclus√£o</h2>
        <button class="close-button" (click)="cancelarExclusao()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="delete-confirmation">
          <div class="warning-icon">‚ö†Ô∏è</div>
          <h3>Tem certeza que deseja excluir este servi√ßo?</h3>
          <p><strong>{{ itemToDelete?.titulo }}</strong></p>
          <p>Cliente: {{ itemToDelete?.cliente }}</p>
          <p class="warning-text">Esta a√ß√£o n√£o pode ser desfeita.</p>
        </div>
        <div class="form-actions">
          <button class="delete-button" (click)="confirmarExclusao()" [disabled]="isDeleting">
            {{ isDeleting ? 'Excluindo...' : 'Sim, Excluir' }}
          </button>
          <button class="cancel-button" (click)="cancelarExclusao()" [disabled]="isDeleting">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>